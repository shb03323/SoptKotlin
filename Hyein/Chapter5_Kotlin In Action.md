# Kotlin In Action

## 5. 람다로 프로그래밍

#### 5.1 람다 식과 멤버 참조

- **람다 (or 람다 식)** 

  : 다른 함수에 넘길 수 있는 작은 코드조각

  :arrow_forward: 쉽게 공통 코드 구조를 라이브러리 함수로 뽑아낼 수 있다.​

  

##### 5.1.1 람다 소개: 코드 블록을 함수 인자로 넘기기

- 일련의 동작을 변수에 저장 / 다른 함수에 넘기기

  - 자바

    - 무명 내부 클래스

  - **함수형 프로그래밍**

    - 함수를 값처럼 다루는 접근 방법

      :arrow_forward: 함수를 직접 다른 함수에 전달할 수 있다.

      - **람다 식**을 통해 코드를 더욱 간결히 할 수 있다.

- **람다 식**
  - 함수 선언 필요 :x:
  - 코드 블록을 직접 함수의 인자로 전달 가능



##### 5.1.2 람다와 컬렉션

- 코드 중복 제거
  - 컬렉션 대부분의 작업 :arrow_forward: 일반적 패턴에 속한다
    - **패턴은 라이브러리안에 있어야 한다**
  - **람다**나 **멤버 참조**를 인자로 취하는 **라이브러리 함수**를 통해 개선 가능

- **람다와 컬렉션**

  ``````kotlin
  val people = listOf(Person("Alice", 29), Person("Bob", 31))
  people.maxBy({it.age})
  ``````

  - `maxBy` : 가장 큰 원소를 찾기 위해 비교에 사용할 값을 돌려주는 함수를 인자로 받는다.

  - **람다는 멤버 참조로 대치할 수 있다**

    ``````kotlin
    people.maxBy(Person::age)
    ``````

    

##### 5.1.3 람다 식의 문법

- **람다**

  - 값처럼 여기저기 전달할 수 있는 동작의 모음

    ``````kotlin
    {x: Int, y: Int -> x+y}
    //	<파라미터>		<본문>
    
    val sum = {x: Int, y: Int -> x+y}
    sum(1,2)
    ``````

    - 항상 중괄호 사이에 위치
    - **->** : 인자 목록(파라미터)와 람다 본문을 구분
    - 람다 식을 변수에 저장 가능

  - `run`
    - 인자로 받은 람다를 실행
    - 코드의 일부분을 블록으로 둘러싸 실행할 필요가 있을 때 사용
  - 실행 시점 람다 호출에는 **아무 부가 비용이 들지 않는다**

  - 람다 구조

    - 함수 호출 시 맨 뒤에 있는 인자가 **람다 식**이라면 그 람다를 **괄호 밖**으로 빼낼 수 있다.

    ``````kotlin
    people.maxBy() {p: Person -> p.age}
    ``````

    - **람다**가 어떤 함수의 **유일한 인자**이고 **괄호 뒤**에 람다를 썼다면 호출 시 **빈 괄호를 없애도 된다**

    ``````kotlin
    people.maxBy {p: Person -> p.age}
    ``````

    - 컴파일러는 **람다 파라미터의 타입도 추론**할 수 있다.

    ``````kotlin
    people.maxBy {p -> p.age}
    ``````

    - 람다의 파라미터 이름을 **디폴트 이름인 it**으로 바꿀 수 있다.
      - 람다의 파라미터가 하나 뿐 + 그 타입을 컴파일러가 추론 가능한 경우
      - 람다 파라미터 이름을 따로 지정하지 않은 경우에만 it이라는 이름이 자동으로 만들어진다.

    ``````kotlin
    people.maxBy {it.age}
    ``````

  - 람다 여러 줄

    :arrow_forward: 맨 마지막에 있는 식이 람다의 결과 값

    

##### 5.1.4 현재 영역에 있는 변수에 접근

- **람다를 함수 안에서 정의**

  :arrow_forward: ​함수의 파라미터, 로컬 변수를 람다에서 사용 가능

- **forEach**

  - 컬렉션의 모든 원소에 **람다를 호출**

    ``````kotlin
    fun printMessageWithPrefix(messages : Collection<String>, prefix: String){
        messages.forEach{
            println("$prifix $it")
        }
    }
    ``````

- 자바와의 차이

  - 람다 안에서는 파이널 변수가 아닌 변수에 접근할 수 있다.
  - 람다 안에서 바깥의 변수를 변경해도 된다.

- **람다가 포획한 변수**

  : 람다 안에서 사용하는 외부 변수

  - 로컬 변수를 포획한 람다를 반환 or 다른 변수에 저장

    :arrow_forward: **로컬 변수의 생명주기와 함수의 생명주기가 달라질 수 있다**

    - 함수 실행이 끝난 뒤에도 람다의 본문코드는 여전히 포획한 변수를 읽거나 쓸 수 있다.
      - **파이널 변수 포획 경우** : 람다 코드를 변수 값과 함께 저장
      - **파이널이 아닌 변수 포획 경우** : 변수를 특별한 래퍼로 감싸서 나중에 변경하거나 읽을 수 있게 한 다음 래퍼에 대한 참조를 람다 코드와 함께 저장한다.



##### 5.1.5 멤버 참조

- **함수를 직접 넘기기**

  - 함수를 값으로 바꾼다 :arrow_forward: `::` 이용

    ``````kotlin
    val getAge = Person::age
    ``````

- **멤버 참조**

  : `::`를 사용하는 식

  - 프로퍼티나 메소드를 단 하나만 호출하는 함수 값을 만들어 준다.

  - 멤버 참조 문법

    ``````kotlin
    클래스::멤버

  - 멤버 참조 뒤에는 괄호를 넣으면 안된다

    ``````kotlin
    people.maxBy(Person::age)
    people.maxBy{p->p.age}
    people.maxBy{it.age}
    ``````

  - 최상위에 선언된(그리고 다른 클래스의 멤버가 아닌) 함수나 프로퍼티 참조 가능

    ```````kotlin
    fun salute() = println("Salute!")
    >>> run(::salute)
    Salute!
    ```````

    - 클래스 이름을 생략하고 `::`로 참조를 바로 시작
    - **생성자 참조**
      - 클래스 생성 작업을 연기하거나 저장해둘 수 있다.
      - `::`뒤에 클래스 이름을 넣으면 생성자 참조 만들 수 있다.

  - 확장함수

    - 멤버 함수와 똑같은 방식으로 참조 가능

    

***



#### 5.2 컬렉션 함수형 API

##### 5.2.1 필수적인 함수: filter와 map

- **filter 함수**

  - 컬렉션을 이터레이션 하면서 주어진 람다에 각 원소를 넘겨서 람다가 **true**를 반환하는 원소만 모은다

    ``````kotlin
    val list = listOf(1,2,3,4)
    list.filter{it%2 == 0}
    ``````
    
    - 원치 않는 원소 제거
    
    - 원소 반환 **불가**
    
      :arrow_forward: **map 함수** 사용

- **map**

  - 람다를 컬렉션의 각 원소에 적용한 결과를 모아서 **새 컬렉션**을 만든다.

    ``````kotlin
    val list = listOf(1,2,3,4)
    list.map{it*it}
    ``````



##### 5.2.2 all, any, count, find: 컬렉션에 술어 적용

- **all, any**
  - 컬렉션의 모든 원소가 어떤 조건을 만족하는지 판단하는 연산

- **count**
  - 조건을 만족하는 원소의 개수를 반환
- **find**
  - 조건을 만족하는 첫 번째 원소를 반환
  - 만족하는 원소가 전혀 없는 경우 `null`을 반환



##### 5.2.3 groupBy: 리스트를 여러 그룹으로 이뤄진 맵으로 변경

- **groupBy**
  - 특성을 파라미터로 전달하면 컬렉션을 자동으로 구분
  - 결과 : 맵
    - key : 컬렉션의 원소를 구분하는 특성
    - value : 키 값에 따른 각 그룹



##### 5.2.4 flatMap과 flatten: 중첩된 컬렉션 안의 원소 처리

- **flatMap**

  - 인자로 주어진 람다를 컬렉션의 모든 객체에 적용 : map

  - 람다를 적용한 결과 얻어지는 여러 리스트를 한 리스트로 한데 모은다 : flatten

    ``````kotlin
    val strings = listOf("abc", "def")
    strings.flatMap {it.toList()}
    ``````

  - **flatMap**
    - 모든 중첩된 리스트의 원소를 한 리스트로 모아야 한다
  - **flatten**
    - 특별히 변환해야할 내용이 없고 리스트를 평평하게 펼치기만 하면 된다.
